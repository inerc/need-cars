<?php return array (
  'unique_key' => 'category',
  'preserve_keys' => false,
  'update_object' => true,
  'related_objects' => 
  array (
    'Plugins' => 
    array (
      '55602095ebcf2f4ce0da1c3b7590f954' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '72d3d74699159c71a7f0751e9c6481a0' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnFileManagerUpload","priority":0,"propertyset":0}',
              'guid' => '748706c9ab528fced231ad2d7e34f883',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnFileManagerUpload',
              ),
              'signature' => 'dc59610d4e1fb8c2bb0305b76f735965',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":0,"property_preprocess":0,"name":"ResizeImageOnUpload","description":"Plugin for auto edit pictures with PhpThumbOf snippet on download.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/**\\n * ResizeImageOnUpload Plugin updated by Setest\\n \\n * Author: Stepan Prishepenko (Setest) <itman116@gmail.com> (01.04.2013)\\n\\n * Version: 1.1.2 (08.04.2013) fix errors\\n * Version: 1.1.1 (05.04.2013) fix errors\\n * Version: 1.1.0 (03.04.2013) fix some errors, add new parameter \\"exclude_dirs_suffix\\"\\n * Version: 1.0.0 (01.04.2013) It`s must correctly work in ModX {REVO} 2.2 - 2.2.6\\n \\n * Events: OnFileManagerUpload\\n * Required: PhpThumbOf snippet for resizing images\\n\\n * Based on: Vasiliy Naumkin (04.08.2012) <bezumkin@yandex.ru>  http:\\/\\/bezumkin.ru\\/blog\\/2012\\/08\\/04\\/resizeonupload\\/\\n * Edited by Aleksey Naumov (08.10.2012)  http:\\/\\/www.createit.ru\\/blog\\/modx\\/2012\\/plugin-resizeimageonupload-modx-revo\\/\\n * Good idea by Mordynsky Nicholay (create storage thumbs folder) (28.03.2013)\\n\\n \\n \\n\\t\\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043b\\u0430\\u0434\\u0430\\u0435\\u0442 \\u0441\\u043b\\u0435\\u0434\\u0443\\u044e\\u0449\\u0438\\u043c\\u0438 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0430\\u043c\\u0438 \\u0438 \\u0438\\u0445 \\u0432\\u043e\\u0437\\u043c\\u043e\\u0436\\u043d\\u043e\\u0441\\u0442\\u044f\\u043c\\u0438:\\n\\tcreate_thumbs - \\u043f\\u0440\\u0438 \\u0414\\u0410 \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442 \\u043f\\u0440\\u0438\\u0432\\u044c\\u044e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439\\n\\tthumbnail_dir - \\u0435\\u0441\\u043b\\u0438 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d\\u043e, \\u0442\\u043e \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e, \\u0440\\u043e\\u0434\\u0438\\u0442\\u0435\\u043b\\u0435\\u043c \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0439 \\u044f\\u0432\\u043b\\u044f\\u0435\\u0442\\u0441\\u044f base_path \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0439 \\u0445\\u0440\\u0430\\u043d\\u044f\\u0442\\u0441\\u044f \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439.\\n\\t\\t\\t\\t\\t\\u0422\\u043e\\u0447\\u043a\\u0438 \\u0438\\u0437 \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u044f \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0443\\u0434\\u0430\\u043b\\u044f\\u044e\\u0442\\u0441\\u044f.\\n\\tthumb_key\\t  - \\u041a\\u043b\\u044e\\u0447 \\u0434\\u043e\\u0431\\u0430\\u0432\\u043b\\u044f\\u044e\\u0449\\u0438\\u0439\\u0441\\u044f \\u0432 \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430 \\u043f\\u0440\\u0435\\u0434\\u043f\\u0440\\u043e\\u0441\\u043c\\u043e\\u0442\\u0440\\u0430.\\n\\tdefault_thumb_path - \\u0415\\u0441\\u043b\\u0438 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d, \\u0442\\u043e \\u0438\\u0433\\u043d\\u043e\\u0440\\u0438\\u0440\\u0443\\u0435\\u0442\\u0441\\u044f \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440 \\"thumbnail_dir\\" \\u0438 \\u0432\\u0441\\u0435 \\u0444\\u0430\\u0439\\u043b\\u044b \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u044e\\u0442\\u0441\\u044f \\u0432 \\u044d\\u0442\\u0443 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e.\\n\\n\\tdefault_src_param - \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0438\\u0441\\u0445\\u043e\\u0434\\u043d\\u043e\\u0433\\u043e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e, \\u0437\\u0430\\u0434\\u0430\\u044e\\u0442\\u0441\\u044f \\u0432 \\u0441\\u043e\\u043e\\u0442\\u0432\\u0435\\u0442\\u0441\\u0442\\u0432\\u0438\\u0438 \\u0441 \\u043f\\u0440\\u0430\\u0432\\u0438\\u043b\\u0430\\u043c\\u0438 PhpThumbOf\\n\\t\\t\\t\\t\\t\\t\\u043f\\u0440\\u0438\\u043c\\u0435\\u0440: \'w\'=800,\'h\'=600,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|\\/assets\\/img\\/watermark.png|BR|100|0|0\'\\n\\t\\t\\t\\t\\t\\t\\u043c\\u043e\\u0436\\u043d\\u043e \\u0438 \\u0442\\u0430\\u043a: w=800,h=600,zc=0,q=80,fltr=wmi|\\/assets\\/img\\/watermark.png|BR|100|0|0\\n\\tdefault_thumb_param - \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b thumbs \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u043e-\\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e\\n\\n\\tlog - \\u043f\\u0440\\u0438 == true \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043b\\u043e\\u0433 \\u0444\\u0430\\u0439\\u043b \\u0441 \\u0438\\u043c\\u0435\\u043d\\u0435\\u043c \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\n\\n\\t\\u0418\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f - \\u0443\\u0441\\u043b\\u043e\\u0432\\u0438\\u044f \\u043f\\u0440\\u0438 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u0440\\u044b\\u0432\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443:\\n\\texclude_dirs - \\u043f\\u0443\\u0442\\u044c \\u043a \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044f\\u043c \\u0440\\u0430\\u0437\\u0434\\u0435\\u043b\\u0435\\u043d\\u043d\\u0435 \\u0437\\u0430\\u043f\\u044f\\u0442\\u044b\\u043c\\u0438, \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u0440\\u0430\\u0431\\u043e\\u0442\\u0430\\u0442\\u044c \\u043d\\u0435 \\u0431\\u0443\\u0434\\u0435\\u0442\\n\\texclude_dirs_children - \\u043f\\u0440\\u0438 \\u0414\\u0410 \\u0440\\u0430\\u0441\\u043f\\u0440\\u043e\\u0441\\u0442\\u0440\\u0430\\u044f\\u043d\\u0435\\u0442 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0440\\u043e\\u0434\\u0438\\u0442\\u0435\\u043b\\u044f \\u043d\\u0430 \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438\\n\\texclude_part_of_name - \\u0435\\u0441\\u043b\\u0438 \\u0438\\u043c\\u044f \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u0435\\u043c\\u043e\\u0433\\u043e \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0442\\u0435\\u043a\\u0441\\u0442 \\u0438\\u0437 \\u0434\\u0430\\u043d\\u043d\\u043e\\u0433\\u043e \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0430, \\u0442\\u043e \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u043a\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443\\n\\texclude_sources - \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0438 \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u0440\\u0438 \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u043d\\u0438\\u0438 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u043a\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443,\\n\\t\\t\\t\\t\\t  \\u043f\\u0440\\u0438\\u043d\\u0438\\u043c\\u0430\\u0435\\u0442 \\u0438\\u043c\\u044f \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430 \\u0438\\u043b\\u0438 \\u0435\\u0433\\u043e id \\u043f\\u0435\\u0440\\u0435\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u043d\\u044b\\u0435 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0437\\u0430\\u043f\\u044f\\u0442\\u0443\\u044e.\\n\\t\\t\\t\\t\\t  \\u0411\\u0443\\u0434\\u044c\\u0442\\u0435 \\u0432\\u043d\\u0438\\u043c\\u0430\\u0442\\u0435\\u043b\\u044c\\u043d\\u044b \\u043f\\u0440\\u0438 \\u0432\\u0432\\u043e\\u0434\\u0435 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0441\\u043b\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u043e\\u043c \\u0431\\u0443\\u043a\\u0432.\\n\\t\\t\\t\\t\\t  \\u043f\\u0440\\u0438\\u043c\\u0435\\u0440: Images, 5, hohoho, tetki\\n\\n *\\/\\n \\n \\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e\\u0435 \\u0441\\u043e\\u0431\\u044b\\u0442\\u0438\\u0435\\nif ($modx->event->name != \'OnFileManagerUpload\') {return;}\\n\\n$modx->lexicon->load(\'resizeimageonupload:default\');\\n\\n$log = $modx->getOption(\'log\', $scriptProperties,false);\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/--=LOG=--\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\nif ($log){\\n\\t$logFileName = $modx->event->activePlugin;\\n\\t$modx->setLogLevel(modX::LOG_LEVEL_INFO);\\n\\t\\t$date = date(\'Y-m-d____H-i-s\');  \\/\\/ \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u0442\\u044c \\u0432 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0435 \\u0434\\u0430\\u0442\\u044b : - \\u043d\\u0435\\u043b\\u044c\\u0437\\u044f, \\u0438\\u043d\\u0430\\u0447\\u0435 \\u043d\\u0435 \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043b\\u043e\\u0433 \\u0432 \\u0444\\u0430\\u0439\\u043b\\n\\t\\t$modx->setLogTarget(array(\\n\\t\\t   \'target\' => \'FILE\',\\n\\t\\t   \'options\' => array(\'filename\' => \\"{$logFileName}_$date.log\\")\\n\\t\\t));\\n\\t$start_time_global = microtime(true); \\/\\/\\u043e\\u0431\\u0449\\u0435\\u0435 \\u0432\\u0440\\u0435\\u043c\\u044f \\u0432\\u044b\\u043f\\u043e\\u043b\\u043d\\u0435\\u043d\\u0438\\u044f \\u0441\\u043a\\u0440\\u0438\\u043f\\u0442\\u0430\\n}\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/--=LOG=--\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\n\\n\\n\\/\\/ \\u043f\\u043e\\u0434\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c phpthumb\\nrequire_once MODX_CORE_PATH.\'model\\/phpthumb\\/phpthumb.class.php\';\\n\\n\\/\\/ \\u0441\\u0434\\u0435\\u0441\\u044c \\u0432\\u044b \\u043c\\u043e\\u0436\\u0435\\u0442\\u0435 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u044c \\u043e\\u0441\\u043e\\u0431\\u044b\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438 \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u0431\\u0443\\u0434\\u0443\\u0442 \\u043e\\u0441\\u043e\\u0431\\u044b\\u0435 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n\\/\\/ \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0438 \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439\\n\\/\\/ $config = array(\\n \\/\\/ \'assets\\/upload\\/folder1\\/\' => array(\\n   \\/\\/ \'src\' => array(\'w\' => 800,\'h\' => 600,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),\\n \\/\\/ ),\\n \\/\\/ \'assets\\/upload\\/folder2\\/\' => array(\\n   \\/\\/ \'src\' => array(\'w\' => 400,\'h\' => 300,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),\\n   \\/\\/ \'thumb\' =>array(\'w\' => 200,\'h\' => 150,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 70),\\n \\/\\/ ),\\n\\/\\/ );\\n\\n$config_default_src_param = $modx->getOption(\'default_src_param\', $scriptProperties, \\"\'w\'=1280,\'h\'=1024,\'zc\'=0,\'q\'=80\\");\\n$config_default_thumb_param = $modx->getOption(\'default_thumb_param\', $scriptProperties, \\"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70\\");\\n\\/\\/ $config_default_src_param = \\"w=600,zc=0,q=80,fltr=wmi|\\/assets\\/templates\\/new\\/img\\/others\\/logo_watermark.png|BR|100|0|0\\";\\n\\/\\/ $config_default_thumb_param = \\"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70\\";\\n\\n\\n$create_thumbs = $modx->getOption(\'create_thumbs\', $scriptProperties);\\n$thumbnail_dir = $modx->getOption(\'thumbnail_dir\', $scriptProperties);\\n$thumbnail_dir = str_replace(\'\\/\\/\', \'\\/\', $thumbnail_dir);\\n$thumbnail_dir = str_replace(array(\\"..\\",\\".\\"), \\"\\", $thumbnail_dir);\\n$default_thumb_path = $modx->getOption(\'default_thumb_path\',$scriptProperties,null); \\/\\/ assets\\/images\\/thumbs\\n$thumb_key = $modx->getOption(\'thumb_key\',$scriptProperties,\'\'); \\/\\/ this parameter add in the filename of thumbnail\\n\\n$exclude_dirs = $modx->getOption(\'exclude_dirs\', $scriptProperties, null);\\t\\/\\/ \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f\\n$exclude_dirs_suffix = $modx->getOption(\'exclude_dirs_suffix\', $scriptProperties, \\"{ExChild}\\");\\t\\/\\/ \\u0441\\u0443\\u0444\\u0444\\u0438\\u043a\\u0441 \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f, \\u043f\\u0440\\u0438 \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0438, \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0433\\u043e \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u044e\\u0442\\u0441\\u044f\\n$exclude_dirs_children = $modx->getOption(\'exclude_dirs_children\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043b\\u0438 \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438?\\n\\n$exclude_part_of_name = $modx->getOption(\'exclude_part_of_name\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u043f\\u0440\\u0438 \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0438 \\u0432 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0444\\u0430\\u0439\\u043b\\u0430 \\u044d\\u0442\\u043e\\u0433\\u043e \\u0442\\u0435\\u043a\\u0441\\u0442\\u0430\\n$exclude_sources = $modx->getOption(\'exclude_sources\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u043f\\u043e \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430\\u043c.  \\u041c\\u043e\\u0436\\u043d\\u043e \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u0442\\u044c id \\u0438 \\u0438\\u043c\\u044f \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0431\\u0443\\u0434\\u044c\\u0442\\u0435 \\u0432\\u043d\\u0438\\u043c\\u0430\\u0442\\u0435\\u043b\\u044c\\u043d\\u044b \\u043f\\u0440\\u0438 \\u0432\\u0432\\u043e\\u0434\\u0435 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0441\\u043b\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u043e\\u043c \\u0431\\u0443\\u043a\\u0432.\\n\\n$exclude_extensions = $modx->getOption(\'exclude_extensions\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0444\\u0430\\u0439\\u043b\\u044b \\u0441 \\u0440\\u0430\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435\\u043c ... \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0430\\u0449\\u0438\\u0435\\u0441\\u044f \\u0432 exclude_extensions, \\u043f\\u0435\\u0440\\u0435\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u043d\\u044b\\u0435 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0437\\u0430\\u043f\\u044f\\u0442\\u0443\\u044e\\n\\n\\/\\/ \\u043f\\u0435\\u0440\\u0435\\u0441\\u0442\\u0440\\u0430\\u0445\\u0443\\u0435\\u043c\\u0441\\u044f \\u0438 \\u0443\\u0434\\u0430\\u043b\\u0438\\u043c \\u043b\\u0438\\u0448\\u043d\\u0438\\u0435 \\u043a\\u0430\\u0432\\u044b\\u0447\\u043a\\u0438\\n$config_default_src_param = str_replace(array(\\"\'\\",\\" \\"),\\"\\",$config_default_src_param);\\n$config_default_thumb_param = str_replace(array(\\"\'\\",\\" \\"),\\"\\",$config_default_thumb_param);\\n\\n\\/\\/ \'w\'=580,\'h\'=324,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|\\/assets\\/templates\\/new\\/img\\/others\\/logo_watermark.png|BR|100|0|0\'\\n\\n\\/\\/ \\u0444\\u0443\\u043d\\u043a\\u0446\\u0438\\u044f \\u0440\\u0430\\u0437\\u0431\\u0438\\u0432\\u0430\\u0435\\u0442 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0443 \\u0432\\u0438\\u0434\\u0430 \\"\'param1\'=\'value1\',...\\" \\u0438 \\u0432\\u043e\\u0437\\u0432\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u043c\\u0430\\u0441\\u0441\\u0438\\u0432\\nif (!function_exists(\'getconfigparam\')) {\\n\\t\\/\\/ function getconfigparam($config_default_param, $type){\\n\\tfunction getconfigparam($config_default_param){\\n\\t\\tforeach (explode(\\",\\",$config_default_param) as $parametr) {\\n\\t\\t\\t$param_arr=explode(\\"=\\",$parametr);\\n\\t\\t\\t\\t\\/\\/ $param[$type][$param_arr[0]]=$param_arr[1];\\n\\t\\t\\t\\t$param[$param_arr[0]]=$param_arr[1];\\n\\t\\t}\\n\\t\\treturn $param;\\n\\t}\\n}\\n\\n\\/\\/ \\u043f\\u043e\\u043b\\u0443\\u0447\\u0430\\u0435\\u043c \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u044e \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e\\n$config_default = array(\\n\\t\\"src\\"\\t=>\\tgetconfigparam($config_default_src_param),\\n\\t\\"thumb\\" =>\\tgetconfigparam($config_default_thumb_param)\\n);\\n\\n\\/\\/ \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u0435\\u043c\\u043e\\u0433\\u043e \\u0444\\u0430\\u0439\\u043b\\u0430\\n$file = $modx->event->params[\'files\'][\'file\'];\\n$cur_dir = $modx->event->params[\'directory\'];\\n\\n\\n\\/\\/ \\u043f\\u043e\\u043b\\u0443\\u0447\\u0430\\u0435\\u043c media source\\n$ms = $modx->event->params[\'source\'];\\n\\/\\/ \\u0440\\u0430\\u0441\\u0441\\u043a\\u043e\\u043c\\u0435\\u043d\\u0442\\u0438\\u0440\\u043e\\u0432\\u0430\\u0432 \\u0441\\u043b\\u0435\\u0434 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0443 \\u0432\\u044b \\u043c\\u043e\\u0436\\u0435\\u0442\\u0435 \\u0432\\u0437\\u0433\\u043b\\u044f\\u043d\\u0443\\u0442\\u044c \\u043d\\u0430 \\u043d\\u0430\\u0447\\u0438\\u043d\\u043a\\u0443 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430\\n\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($ms->toArray(),true));\\n\\nif (!empty($exclude_sources)){\\n\\t$exclude_sources = str_replace(\' \', \'\', $exclude_sources);\\n\\t$exclude_sources=explode(\\",\\",$exclude_sources);\\n\\tforeach ($exclude_sources as $sources) {\\n\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, is_numeric($sources));\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Sources list: $sources - \\".$ms->name);\\n\\t\\tif (is_numeric($sources)) {\\n\\t\\t\\tif ($ms->id==(int)$sources) return;\\n\\t\\t}\\n\\t\\telse {\\n\\t\\t\\tif ($ms->name==$sources) return;\\n\\t\\t}\\n\\t}\\t\\n}\\n\\n\\nif($ms == null){\\n\\t\\/\\/ return $modx->error->failure(\\"\\u041e\\u0448\\u0438\\u0431\\u043a\\u0430, \\u043d\\u0435 \\u0443\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043f\\u043e\\u043b\\u0443\\u0447\\u0438\\u0442\\u044c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u043e\\u0431 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0435 \\u0444\\u0430\\u0439\\u043b\\u043e\\u0432\\");\\n\\t\\/\\/ \\u0442\\u0443\\u0442 \\u043d\\u0443\\u0436\\u043d\\u043e \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u0438\\u0442\\u044c \\u0432\\u0435\\u0440\\u0441\\u0438\\u044e modx, \\u0435\\u0441\\u043b\\u0438 \\u043e\\u043d\\u0430 \\u043c\\u043b\\u0430\\u0434\\u0448\\u0435 2.2.4 \\u0442\\u043e\\n\\t\\/\\/ \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u0443\\u0435\\u043c \\n\\t\\/\\/ foreach ($files as $file) {\\n\\t\\t\\/\\/ $ext = @pathinfo($file[\'name\'],PATHINFO_EXTENSION);\\n\\t\\t\\/\\/ rename($cur_dir->getPath().$file[\'name\'], $directory->getPath().UrlTranslit($file[\'name\']));\\n\\t\\/\\/ }\\n\\t\\/\\/ \\u0442\\u043a \\u0432 \\u0441\\u0442\\u0430\\u0440\\u044b\\u0445 \\u0432\\u0435\\u0440\\u0441\\u0438\\u044f\\u0445 \\u0432\\u044b\\u0437\\u043e\\u0432 \\u0441\\u043e\\u0431\\u044b\\u0442\\u0438\\u044f \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0438 \\u0448\\u0435\\u043b \\u043e\\u0434\\u0438\\u043d \\u0440\\u0430\\u0437, \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u0438\\u0442\\u044c!\\n\\t$cur_dir=$directory->getPath();\\n\\n}\\nelse {\\n\\t\\/\\/ \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0438 media source\\n\\t$msProperties = $ms->get(\'properties\');\\n\\t$cur_dir = $msProperties[\'basePath\'][\'value\'].$cur_dir;\\n\\t\\/\\/ \\u043d\\u0430 \\u0432\\u0441\\u044f\\u043a\\u0438\\u0439 \\u0441\\u043b\\u0443\\u0447\\u0430\\u0439 \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0435 \\/\\/ \\u0438 \\u0437\\u0430\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430 \\/\\n\\t$cur_dir = str_replace(\'\\/\\/\', \'\\/\', $cur_dir);\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"\\\\$cur_dir: $cur_dir\\");\\n\\t\\n\\t\\/\\/ \\u0441\\u043c\\u043e\\u0442\\u0440\\u0438\\u043c, \\u0447\\u0442\\u043e \\u043f\\u0440\\u0438 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0435 \\u043d\\u0435 \\u0432\\u043e\\u0437\\u043d\\u0438\\u043a\\u043b\\u043e \\u043e\\u0448\\u0438\\u0431\\u043e\\u043a\\n\\tif ($file[\'error\'] != 0) {\\n\\t\\treturn $modx->error->failure($modx->lexicon(\'rionup_error_download\'));\\n\\t}\\n}\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438\\n\\/\\/ if ($exclude_dirs and $exclude_dirs=str_replace(\' \', \'\', $exclude_dirs) and (in_array($cur_dir,explode(\\",\\",$exclude_dirs)))){\\nif ($exclude_dirs and ($exclude_dirs=explode(\\",\\",$exclude_dirs))){\\n\\tif ($exclude_dirs_children) {\\n\\t\\n\\t\\tforeach ($exclude_dirs as $path) {\\n\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"EXCLUDE DIRS CONDITIONS: $cur_dir == $path\\");\\n\\t\\t\\t\\/\\/ if ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0432 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0435 &ExChild\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except {$exclude_dirs_suffix} in: {$path}, return;\\");\\n\\t\\t\\t\\/\\/ }\\n\\t\\t\\t\\/\\/ else {\\n\\t\\t\\t\\t\\n\\t\\t\\t\\t\\/\\/ if (strpos($cur_dir, str_replace($exclude_dirs_suffix, \'\', $path)) !== false) \\/\\/return;\\n\\t\\t\\t\\tif (strpos($cur_dir, $path) !== false) \\/\\/return;\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\/\\/ return $modx->error->failure(\\"children\\");\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except children, return;\\");\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\/\\/ }\\n\\t\\t}\\n\\t}\\n\\telse {\\n\\t\\tforeach ($exclude_dirs as $path) {\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"EXCLUDE DIRS CONDITIONS: curdir ($cur_dir), exclude dir ($path)\\");\\n\\t\\t\\tif ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0432 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0435 &ExChild\\n\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except {$exclude_dirs_suffix} in: {$path}, return;\\");\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\tif ($cur_dir==str_replace($exclude_dirs_suffix, \'\', $path)) {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except dir, return;\\");\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\/\\/ return $modx->error->failure(\\"\\u0417\\u0430\\u043f\\u0438\\u0441\\u0430\\u0442\\u044c \\u0432 \\u0434\\u0430\\u043d\\u043d\\u0443\\u044e \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e \\u043d\\u0435\\u043b\\u044c\\u0437\\u044f \\u043e\\u043d\\u0430 \\u043d\\u0430\\u0445\\u043e\\u0434\\u0438\\u0442\\u0441\\u044f \\u0432 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\");\\n\\t\\t\\/\\/ return $modx->error->failure(\\"parent\\");\\n\\t\\t}\\n\\t}\\n}\\n\\n\\/\\/ $name = $file[\'name\'];\\n$name = urldecode($file[\'name\']);\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0432 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0444\\u0430\\u0439\\u043b\\u0430\\nif (!empty($exclude_part_of_name) and (strpos($name, $exclude_part_of_name) !== false)){\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except part of name, return;\\");\\n\\treturn;\\n}\\n\\n$extensions = explode(\',\', $modx->getOption(\'upload_images\'));\\nif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Allowed extensions: \\".implode(\\",\\", $extensions));\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u043c, \\u0447\\u0442\\u043e \\u043d\\u0430\\u0448\\u0430 \\u043a\\u0430\\u0442\\u0435\\u0433\\u043e\\u0440\\u0438\\u044f \\u0437\\u0430\\u0434\\u0430\\u043d\\u0430 \\u0432 \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0430\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\nif (array_key_exists($cur_dir, $config)) {\\n\\t$config = $config[$cur_dir];\\n}\\nelse {\\n\\t$config=$config_default;\\n}\\n\\n\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($config));\\n\\n\\/\\/ \\u043f\\u0443\\u0442\\u044c \\u043a \\u0444\\u0430\\u0439\\u043b\\u0443, \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430, \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435\\n$filename = MODX_BASE_PATH.$cur_dir.$name;\\nif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"SourceFilename: {$filename}\\");\\n$def_fn = pathinfo($name, PATHINFO_FILENAME);\\n$ext = pathinfo($name, PATHINFO_EXTENSION);\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c, \\u0447\\u0442\\u043e \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0437\\u0430\\u0434\\u0430\\u043d\\u043e \\u0432 \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0430\\u0445 MODX, \\u043a\\u0430\\u043a \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0435\\nif (in_array($ext, $extensions)) {\\n\\n\\t\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 \\u0444\\u0430\\u0439\\u043b\\u0430 exclude_extensions\\n\\tif ($exclude_extensions and $exclude_extensions=str_replace(\' \', \'\', $exclude_extensions) and ($exclude_extensions=explode(\\",\\",$exclude_extensions)) and (in_array($ext, $exclude_extensions))){\\n\\t\\t\\/\\/ if (in_array($ext, $exclude_extensions)) {\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except extension of file ({$ext}), return;\\");\\n\\t\\treturn;\\t\\n\\t}\\n\\n\\t\\/\\/ \\u0431\\u0435\\u0436\\u0438\\u043c \\u043f\\u043e \\u0432\\u0441\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f\\u043c \\u043c\\u0430\\u0441\\u0441\\u0438\\u0432\\u0430 \\u0441 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u043e\\u043c\\n\\tforeach($config as $imgKey =>$imgConfig){\\n\\t\\t$options = \'\';\\n\\t\\tif($imgKey == \'src\'){\\n\\t\\t\\t\\/\\/ \\u0434\\u043b\\u044f \\u043a\\u043b\\u044e\\u0447\\u0430 src \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0430\\u0435\\u0442 \\u0441 \\u0438\\u0441\\u0445\\u043e\\u0434\\u043d\\u044b\\u043c\\n\\t\\t\\t$imgName = $filename;\\n\\t\\t}\\n\\t\\telseif ($imgKey == \'thumb\' and $create_thumbs){\\n\\t\\t\\t\\/\\/ \\u0444\\u043e\\u0440\\u043c\\u0438\\u0440\\u0443\\u0435\\u043c \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430\\n\\t\\t\\t\\n\\t\\t\\t\\/\\/$imgName = MODX_BASE_PATH.$cur_dir.$def_fn.\'.\'.$ext.\'.\'.$imgKey.\'.\'.$ext;\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"\\\\$cur_dir: $cur_dir\\");\\n\\t\\t\\tif (!empty($thumbnail_dir) or !empty($default_thumb_path)) {\\n\\t\\t\\t\\t$thumbnail_dir = MODX_BASE_PATH.$cur_dir.$thumbnail_dir.\\"\\/\\";\\n\\t\\t\\t\\tif (!empty($default_thumb_path)) {\\n\\t\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d\\u0430 \\u043f\\u043e\\u0430\\u043f\\u043a\\u0430 \\u043f\\u043e-\\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0434\\u043b\\u044f \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e\\u0448\\u0435\\u043a\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Default thumbnail path exist\\");\\n\\t\\t\\t\\t\\tif (substr($default_thumb_path, -1, 1)!=\\"\\/\\") $default_thumb_path.=\\"\\/\\";\\n\\t\\t\\t\\t\\t$thumbnail_dir = MODX_BASE_PATH.$default_thumb_path;\\t\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail full path: {$thumbnail_dir}\\");\\n\\t\\t\\t\\tif(!is_dir($thumbnail_dir)) {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir not exist\\");\\n\\t\\t\\t\\t\\tif (!mkdir($thumbnail_dir,0755)){\\n\\t\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail error:\\".$modx->lexicon(\'rionup_error_createdir\'));\\n\\t\\t\\t\\t\\t\\treturn $modx->error->failure($modx->lexicon(\'rionup_error_createdir\'));\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse{\\n\\t\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir created successfull\\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir already exist\\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\/\\/ $filename = $thumbnail_dir.$name;\\n\\t\\t\\t\\t\\/\\/ $imgName = $thumbnail_dir.$def_fn.\'_\'.$imgKey.\'.\'.$ext;\\n\\t\\t\\t\\t$imgName = \\"{$thumbnail_dir}{$def_fn}{$thumb_key}_w{$imgConfig[\'w\']}_h{$imgConfig[\'h\']}.{$ext}\\";\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Part: {$imgKey}, imgName: {$imgName}\\");\\n\\n\\t\\t\\/\\/ \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u043c \\u043e\\u0431\\u044a\\u0435\\u043a\\u0442 phpThumb..\\n\\t\\t$phpThumb = new phpThumb();\\n\\t\\t\\/\\/ ..\\u0438 \\u0437\\u0430\\u0434\\u0430\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n\\t\\t\\/\\/ $thumbnail->setOptions($options); \\/\\/ \\u0445\\u043e\\u0442\\u0435\\u043b \\u0447\\u0435\\u0440\\u0435 \\u044d\\u0442\\u043e \\u0441\\u0434\\u0435\\u043b\\u0430\\u0442\\u044c - \\u043d\\u0435 \\u043f\\u043e\\u043b\\u0443\\u0447\\u0438\\u043b\\u043e\\u0441\\u044c\\n\\t\\t$phpThumb->setSourceFilename($filename);\\n\\t\\t\\n\\t\\tif (empty($imgConfig[\'f\'])){\\n\\t\\t\\t$imgConfig[\'f\']=$ext; \\/\\/ \\u0431\\u0435\\u0437 \\u044d\\u0442\\u043e\\u0433\\u043e \\u043c\\u044b \\u043d\\u0435 \\u0443\\u0432\\u0438\\u0434\\u0438\\u043c \\u043f\\u0440\\u043e\\u0437\\u0440\\u0430\\u0447\\u043d\\u043e\\u0441\\u0442\\u0438 \\u0432 png \\u0438 gif\\n\\t\\t}\\n\\t\\tif (!empty($imgConfig)){\\n\\t\\t\\tif (($ext==\'png\' or $ext==\'gif\') and !empty($imgConfig[\'fltr\'])){\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 png \\u0438\\u043b\\u0438 gif \\u0438 \\u043f\\u0440\\u0438\\u043c\\u0435\\u043d\\u044f\\u0435\\u0442\\u0441\\u044f \\u0444\\u0438\\u043b\\u044c\\u0442\\u0440\\n\\t\\t\\t\\t\\/\\/ \\u043f\\u043e\\u0434\\u0440\\u0430\\u0437\\u0443\\u043c\\u0435\\u0432\\u0430\\u0435\\u0442\\u0441\\u044f \\u0434\\u043e\\u0431\\u0430\\u0432\\u043b\\u0435\\u043d\\u0438\\u0435 watermark\\n\\t\\t\\t\\t\\/\\/ \\u0438 \\u0447\\u0442\\u043e\\u0431\\u044b \\u043d\\u0430\\u0448 watermark \\u043d\\u0435 \\u0440\\u0430\\u0441\\u043f\\u043e\\u043b\\u043e\\u0433\\u0430\\u043b\\u0441\\u044f \\u043d\\u0430 \\u0446\\u0432\\u0435\\u0442\\u043d\\u043e\\u043c \\u0444\\u043e\\u043d\\u0435\\n\\t\\t\\t\\t\\/\\/ \\u043c\\u044b \\u0435\\u0433\\u043e \\u0443\\u0434\\u0430\\u043b\\u044f\\u0435\\u043c\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Destroy background for watermark\\");\\n\\t\\t\\t\\t\\/\\/ unset($imgConfig[\'bg\']);\\n\\t\\t\\t}\\n\\t\\t\\t\\n\\t\\t\\tforeach ($imgConfig as $k => $v) {\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO,\\"$k - $v\\");\\n\\t\\t\\t\\t$phpThumb->setParameter($k, $v);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t   \\n\\t\\t\\/\\/ \\u0433\\u0435\\u043d\\u0435\\u0440\\u0438\\u0440\\u0443\\u0435\\u043c \\u0444\\u0430\\u0439\\u043b\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"GenerateThumbnail...\\");\\n\\t\\tif ($phpThumb->GenerateThumbnail()) {\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"RenderToFile: $imgName\\");\\n\\t\\t\\tif ($phpThumb->RenderToFile($imgName)) {\\n\\t\\t\\t\\t\\/\\/ \\u0443\\u0441\\u0442\\u0430\\u043d\\u0430\\u0432\\u043b\\u0438\\u0432\\u0430\\u0435\\u043c \\u043f\\u0440\\u0430\\u0432\\u0430 \\u043d\\u0430 \\u0444\\u0430\\u0439\\u043b, \\u044d\\u0442\\u043e \\u043e\\u043f\\u0446\\u0438\\u043e\\u043d\\u0430\\u043b\\u044c\\u043d\\u043e, \\u0437\\u0430\\u0432\\u0438\\u0441\\u0438\\u0442 \\u043e\\u0442 \\u0441\\u0435\\u0440\\u0432\\u0435\\u0440\\u0430\\n\\t\\t\\t\\tchmod($imgName, 0666);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\\nelse {\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"extension of file ({$ext}) is forbidden for download in system parameters \'upload_images\'. Allow only: \\".implode(\\",\\", $extensions));\\n}\\nreturn;","locked":0,"properties":"a:13:{s:13:\\"create_thumbs\\";a:7:{s:4:\\"name\\";s:13:\\"create_thumbs\\";s:4:\\"desc\\";s:20:\\"rionup_create_thumbs\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:17:\\"default_src_param\\";a:7:{s:4:\\"name\\";s:17:\\"default_src_param\\";s:4:\\"desc\\";s:24:\\"rionup_default_src_param\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:116:\\"\'w\'=800,\'h\'=600,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|\\/assets\\/templates\\/new\\/img\\/others\\/logo_watermark.png|BR|100|0|0|stc|000000\'\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:19:\\"default_thumb_param\\";a:7:{s:4:\\"name\\";s:19:\\"default_thumb_param\\";s:4:\\"desc\\";s:26:\\"rionup_default_thumb_param\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:41:\\"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:18:\\"default_thumb_path\\";a:7:{s:4:\\"name\\";s:18:\\"default_thumb_path\\";s:4:\\"desc\\";s:25:\\"rionup_default_thumb_path\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"exclude_dirs\\";a:7:{s:4:\\"name\\";s:12:\\"exclude_dirs\\";s:4:\\"desc\\";s:19:\\"rionup_exclude_dirs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:53:\\"assets\\/images\\/banners\\/,assets\\/images\\/aliens\\/{ExChild}\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:21:\\"exclude_dirs_children\\";a:7:{s:4:\\"name\\";s:21:\\"exclude_dirs_children\\";s:4:\\"desc\\";s:28:\\"rionup_exclude_dirs_children\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:19:\\"exclude_dirs_suffix\\";a:7:{s:4:\\"name\\";s:19:\\"exclude_dirs_suffix\\";s:4:\\"desc\\";s:26:\\"rionup_exclude_dirs_suffix\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:9:\\"{ExChild}\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:18:\\"exclude_extensions\\";a:7:{s:4:\\"name\\";s:18:\\"exclude_extensions\\";s:4:\\"desc\\";s:25:\\"rionup_exclude_extensions\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:3:\\"gif\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:20:\\"exclude_part_of_name\\";a:7:{s:4:\\"name\\";s:20:\\"exclude_part_of_name\\";s:4:\\"desc\\";s:27:\\"rionup_exclude_part_of_name\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:8:\\"noresize\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"exclude_sources\\";a:7:{s:4:\\"name\\";s:15:\\"exclude_sources\\";s:4:\\"desc\\";s:22:\\"rionup_exclude_sources\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:3:\\"log\\";a:7:{s:4:\\"name\\";s:3:\\"log\\";s:4:\\"desc\\";s:10:\\"rionup_log\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"thumb_key\\";a:7:{s:4:\\"name\\";s:9:\\"thumb_key\\";s:4:\\"desc\\";s:16:\\"rionup_thumb_key\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:6:\\"_thumb\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"thumbnail_dir\\";a:7:{s:4:\\"name\\";s:13:\\"thumbnail_dir\\";s:4:\\"desc\\";s:20:\\"rionup_thumbnail_dir\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:6:\\"thumbs\\";s:7:\\"lexicon\\";s:30:\\"resizeimageonupload:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","disabled":0,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * ResizeImageOnUpload Plugin updated by Setest\\n \\n * Author: Stepan Prishepenko (Setest) <itman116@gmail.com> (01.04.2013)\\n\\n * Version: 1.1.2 (08.04.2013) fix errors\\n * Version: 1.1.1 (05.04.2013) fix errors\\n * Version: 1.1.0 (03.04.2013) fix some errors, add new parameter \\"exclude_dirs_suffix\\"\\n * Version: 1.0.0 (01.04.2013) It`s must correctly work in ModX {REVO} 2.2 - 2.2.6\\n \\n * Events: OnFileManagerUpload\\n * Required: PhpThumbOf snippet for resizing images\\n\\n * Based on: Vasiliy Naumkin (04.08.2012) <bezumkin@yandex.ru>  http:\\/\\/bezumkin.ru\\/blog\\/2012\\/08\\/04\\/resizeonupload\\/\\n * Edited by Aleksey Naumov (08.10.2012)  http:\\/\\/www.createit.ru\\/blog\\/modx\\/2012\\/plugin-resizeimageonupload-modx-revo\\/\\n * Good idea by Mordynsky Nicholay (create storage thumbs folder) (28.03.2013)\\n\\n \\n \\n\\t\\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043b\\u0430\\u0434\\u0430\\u0435\\u0442 \\u0441\\u043b\\u0435\\u0434\\u0443\\u044e\\u0449\\u0438\\u043c\\u0438 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0430\\u043c\\u0438 \\u0438 \\u0438\\u0445 \\u0432\\u043e\\u0437\\u043c\\u043e\\u0436\\u043d\\u043e\\u0441\\u0442\\u044f\\u043c\\u0438:\\n\\tcreate_thumbs - \\u043f\\u0440\\u0438 \\u0414\\u0410 \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442 \\u043f\\u0440\\u0438\\u0432\\u044c\\u044e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439\\n\\tthumbnail_dir - \\u0435\\u0441\\u043b\\u0438 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d\\u043e, \\u0442\\u043e \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e, \\u0440\\u043e\\u0434\\u0438\\u0442\\u0435\\u043b\\u0435\\u043c \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0439 \\u044f\\u0432\\u043b\\u044f\\u0435\\u0442\\u0441\\u044f base_path \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0439 \\u0445\\u0440\\u0430\\u043d\\u044f\\u0442\\u0441\\u044f \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439.\\n\\t\\t\\t\\t\\t\\u0422\\u043e\\u0447\\u043a\\u0438 \\u0438\\u0437 \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u044f \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0443\\u0434\\u0430\\u043b\\u044f\\u044e\\u0442\\u0441\\u044f.\\n\\tthumb_key\\t  - \\u041a\\u043b\\u044e\\u0447 \\u0434\\u043e\\u0431\\u0430\\u0432\\u043b\\u044f\\u044e\\u0449\\u0438\\u0439\\u0441\\u044f \\u0432 \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430 \\u043f\\u0440\\u0435\\u0434\\u043f\\u0440\\u043e\\u0441\\u043c\\u043e\\u0442\\u0440\\u0430.\\n\\tdefault_thumb_path - \\u0415\\u0441\\u043b\\u0438 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d, \\u0442\\u043e \\u0438\\u0433\\u043d\\u043e\\u0440\\u0438\\u0440\\u0443\\u0435\\u0442\\u0441\\u044f \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440 \\"thumbnail_dir\\" \\u0438 \\u0432\\u0441\\u0435 \\u0444\\u0430\\u0439\\u043b\\u044b \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u044e\\u0442\\u0441\\u044f \\u0432 \\u044d\\u0442\\u0443 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e.\\n\\n\\tdefault_src_param - \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0438\\u0441\\u0445\\u043e\\u0434\\u043d\\u043e\\u0433\\u043e \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e, \\u0437\\u0430\\u0434\\u0430\\u044e\\u0442\\u0441\\u044f \\u0432 \\u0441\\u043e\\u043e\\u0442\\u0432\\u0435\\u0442\\u0441\\u0442\\u0432\\u0438\\u0438 \\u0441 \\u043f\\u0440\\u0430\\u0432\\u0438\\u043b\\u0430\\u043c\\u0438 PhpThumbOf\\n\\t\\t\\t\\t\\t\\t\\u043f\\u0440\\u0438\\u043c\\u0435\\u0440: \'w\'=800,\'h\'=600,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|\\/assets\\/img\\/watermark.png|BR|100|0|0\'\\n\\t\\t\\t\\t\\t\\t\\u043c\\u043e\\u0436\\u043d\\u043e \\u0438 \\u0442\\u0430\\u043a: w=800,h=600,zc=0,q=80,fltr=wmi|\\/assets\\/img\\/watermark.png|BR|100|0|0\\n\\tdefault_thumb_param - \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b thumbs \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u043e-\\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e\\n\\n\\tlog - \\u043f\\u0440\\u0438 == true \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043b\\u043e\\u0433 \\u0444\\u0430\\u0439\\u043b \\u0441 \\u0438\\u043c\\u0435\\u043d\\u0435\\u043c \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\n\\n\\t\\u0418\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f - \\u0443\\u0441\\u043b\\u043e\\u0432\\u0438\\u044f \\u043f\\u0440\\u0438 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u0440\\u044b\\u0432\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443:\\n\\texclude_dirs - \\u043f\\u0443\\u0442\\u044c \\u043a \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044f\\u043c \\u0440\\u0430\\u0437\\u0434\\u0435\\u043b\\u0435\\u043d\\u043d\\u0435 \\u0437\\u0430\\u043f\\u044f\\u0442\\u044b\\u043c\\u0438, \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u0440\\u0430\\u0431\\u043e\\u0442\\u0430\\u0442\\u044c \\u043d\\u0435 \\u0431\\u0443\\u0434\\u0435\\u0442\\n\\texclude_dirs_children - \\u043f\\u0440\\u0438 \\u0414\\u0410 \\u0440\\u0430\\u0441\\u043f\\u0440\\u043e\\u0441\\u0442\\u0440\\u0430\\u044f\\u043d\\u0435\\u0442 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0440\\u043e\\u0434\\u0438\\u0442\\u0435\\u043b\\u044f \\u043d\\u0430 \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438\\n\\texclude_part_of_name - \\u0435\\u0441\\u043b\\u0438 \\u0438\\u043c\\u044f \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u0435\\u043c\\u043e\\u0433\\u043e \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0442\\u0435\\u043a\\u0441\\u0442 \\u0438\\u0437 \\u0434\\u0430\\u043d\\u043d\\u043e\\u0433\\u043e \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0430, \\u0442\\u043e \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u043a\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443\\n\\texclude_sources - \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0438 \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u043f\\u0440\\u0438 \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u043d\\u0438\\u0438 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043f\\u0440\\u0435\\u043a\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u0440\\u0430\\u0431\\u043e\\u0442\\u0443,\\n\\t\\t\\t\\t\\t  \\u043f\\u0440\\u0438\\u043d\\u0438\\u043c\\u0430\\u0435\\u0442 \\u0438\\u043c\\u044f \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430 \\u0438\\u043b\\u0438 \\u0435\\u0433\\u043e id \\u043f\\u0435\\u0440\\u0435\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u043d\\u044b\\u0435 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0437\\u0430\\u043f\\u044f\\u0442\\u0443\\u044e.\\n\\t\\t\\t\\t\\t  \\u0411\\u0443\\u0434\\u044c\\u0442\\u0435 \\u0432\\u043d\\u0438\\u043c\\u0430\\u0442\\u0435\\u043b\\u044c\\u043d\\u044b \\u043f\\u0440\\u0438 \\u0432\\u0432\\u043e\\u0434\\u0435 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0441\\u043b\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u043e\\u043c \\u0431\\u0443\\u043a\\u0432.\\n\\t\\t\\t\\t\\t  \\u043f\\u0440\\u0438\\u043c\\u0435\\u0440: Images, 5, hohoho, tetki\\n\\n *\\/\\n \\n \\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e\\u0435 \\u0441\\u043e\\u0431\\u044b\\u0442\\u0438\\u0435\\nif ($modx->event->name != \'OnFileManagerUpload\') {return;}\\n\\n$modx->lexicon->load(\'resizeimageonupload:default\');\\n\\n$log = $modx->getOption(\'log\', $scriptProperties,false);\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/--=LOG=--\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\nif ($log){\\n\\t$logFileName = $modx->event->activePlugin;\\n\\t$modx->setLogLevel(modX::LOG_LEVEL_INFO);\\n\\t\\t$date = date(\'Y-m-d____H-i-s\');  \\/\\/ \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u0442\\u044c \\u0432 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0435 \\u0434\\u0430\\u0442\\u044b : - \\u043d\\u0435\\u043b\\u044c\\u0437\\u044f, \\u0438\\u043d\\u0430\\u0447\\u0435 \\u043d\\u0435 \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043b\\u043e\\u0433 \\u0432 \\u0444\\u0430\\u0439\\u043b\\n\\t\\t$modx->setLogTarget(array(\\n\\t\\t   \'target\' => \'FILE\',\\n\\t\\t   \'options\' => array(\'filename\' => \\"{$logFileName}_$date.log\\")\\n\\t\\t));\\n\\t$start_time_global = microtime(true); \\/\\/\\u043e\\u0431\\u0449\\u0435\\u0435 \\u0432\\u0440\\u0435\\u043c\\u044f \\u0432\\u044b\\u043f\\u043e\\u043b\\u043d\\u0435\\u043d\\u0438\\u044f \\u0441\\u043a\\u0440\\u0438\\u043f\\u0442\\u0430\\n}\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/--=LOG=--\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\n\\n\\n\\/\\/ \\u043f\\u043e\\u0434\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c phpthumb\\nrequire_once MODX_CORE_PATH.\'model\\/phpthumb\\/phpthumb.class.php\';\\n\\n\\/\\/ \\u0441\\u0434\\u0435\\u0441\\u044c \\u0432\\u044b \\u043c\\u043e\\u0436\\u0435\\u0442\\u0435 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u044c \\u043e\\u0441\\u043e\\u0431\\u044b\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438 \\u0432 \\u043a\\u043e\\u0442\\u043e\\u0440\\u044b\\u0445 \\u0431\\u0443\\u0434\\u0443\\u0442 \\u043e\\u0441\\u043e\\u0431\\u044b\\u0435 \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n\\/\\/ \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0438 \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0439\\n\\/\\/ $config = array(\\n \\/\\/ \'assets\\/upload\\/folder1\\/\' => array(\\n   \\/\\/ \'src\' => array(\'w\' => 800,\'h\' => 600,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),\\n \\/\\/ ),\\n \\/\\/ \'assets\\/upload\\/folder2\\/\' => array(\\n   \\/\\/ \'src\' => array(\'w\' => 400,\'h\' => 300,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),\\n   \\/\\/ \'thumb\' =>array(\'w\' => 200,\'h\' => 150,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 70),\\n \\/\\/ ),\\n\\/\\/ );\\n\\n$config_default_src_param = $modx->getOption(\'default_src_param\', $scriptProperties, \\"\'w\'=1280,\'h\'=1024,\'zc\'=0,\'q\'=80\\");\\n$config_default_thumb_param = $modx->getOption(\'default_thumb_param\', $scriptProperties, \\"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70\\");\\n\\/\\/ $config_default_src_param = \\"w=600,zc=0,q=80,fltr=wmi|\\/assets\\/templates\\/new\\/img\\/others\\/logo_watermark.png|BR|100|0|0\\";\\n\\/\\/ $config_default_thumb_param = \\"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70\\";\\n\\n\\n$create_thumbs = $modx->getOption(\'create_thumbs\', $scriptProperties);\\n$thumbnail_dir = $modx->getOption(\'thumbnail_dir\', $scriptProperties);\\n$thumbnail_dir = str_replace(\'\\/\\/\', \'\\/\', $thumbnail_dir);\\n$thumbnail_dir = str_replace(array(\\"..\\",\\".\\"), \\"\\", $thumbnail_dir);\\n$default_thumb_path = $modx->getOption(\'default_thumb_path\',$scriptProperties,null); \\/\\/ assets\\/images\\/thumbs\\n$thumb_key = $modx->getOption(\'thumb_key\',$scriptProperties,\'\'); \\/\\/ this parameter add in the filename of thumbnail\\n\\n$exclude_dirs = $modx->getOption(\'exclude_dirs\', $scriptProperties, null);\\t\\/\\/ \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f\\n$exclude_dirs_suffix = $modx->getOption(\'exclude_dirs_suffix\', $scriptProperties, \\"{ExChild}\\");\\t\\/\\/ \\u0441\\u0443\\u0444\\u0444\\u0438\\u043a\\u0441 \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f, \\u043f\\u0440\\u0438 \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0438, \\u043a\\u043e\\u0442\\u043e\\u0440\\u043e\\u0433\\u043e \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u043f\\u0430\\u043f\\u043a\\u0438 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u044e\\u0442\\u0441\\u044f\\n$exclude_dirs_children = $modx->getOption(\'exclude_dirs_children\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043b\\u0438 \\u0434\\u043e\\u0447\\u0435\\u0440\\u043d\\u0438\\u0435 \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438?\\n\\n$exclude_part_of_name = $modx->getOption(\'exclude_part_of_name\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u043f\\u0440\\u0438 \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0438 \\u0432 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0444\\u0430\\u0439\\u043b\\u0430 \\u044d\\u0442\\u043e\\u0433\\u043e \\u0442\\u0435\\u043a\\u0441\\u0442\\u0430\\n$exclude_sources = $modx->getOption(\'exclude_sources\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u043f\\u043e \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430\\u043c.  \\u041c\\u043e\\u0436\\u043d\\u043e \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u043e\\u0432\\u0430\\u0442\\u044c id \\u0438 \\u0438\\u043c\\u044f \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0431\\u0443\\u0434\\u044c\\u0442\\u0435 \\u0432\\u043d\\u0438\\u043c\\u0430\\u0442\\u0435\\u043b\\u044c\\u043d\\u044b \\u043f\\u0440\\u0438 \\u0432\\u0432\\u043e\\u0434\\u0435 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430, \\u0441\\u043b\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u043e\\u043c \\u0431\\u0443\\u043a\\u0432.\\n\\n$exclude_extensions = $modx->getOption(\'exclude_extensions\', $scriptProperties, null);\\t\\/\\/ \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0444\\u0430\\u0439\\u043b\\u044b \\u0441 \\u0440\\u0430\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435\\u043c ... \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0430\\u0449\\u0438\\u0435\\u0441\\u044f \\u0432 exclude_extensions, \\u043f\\u0435\\u0440\\u0435\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u043d\\u044b\\u0435 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0437\\u0430\\u043f\\u044f\\u0442\\u0443\\u044e\\n\\n\\/\\/ \\u043f\\u0435\\u0440\\u0435\\u0441\\u0442\\u0440\\u0430\\u0445\\u0443\\u0435\\u043c\\u0441\\u044f \\u0438 \\u0443\\u0434\\u0430\\u043b\\u0438\\u043c \\u043b\\u0438\\u0448\\u043d\\u0438\\u0435 \\u043a\\u0430\\u0432\\u044b\\u0447\\u043a\\u0438\\n$config_default_src_param = str_replace(array(\\"\'\\",\\" \\"),\\"\\",$config_default_src_param);\\n$config_default_thumb_param = str_replace(array(\\"\'\\",\\" \\"),\\"\\",$config_default_thumb_param);\\n\\n\\/\\/ \'w\'=580,\'h\'=324,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|\\/assets\\/templates\\/new\\/img\\/others\\/logo_watermark.png|BR|100|0|0\'\\n\\n\\/\\/ \\u0444\\u0443\\u043d\\u043a\\u0446\\u0438\\u044f \\u0440\\u0430\\u0437\\u0431\\u0438\\u0432\\u0430\\u0435\\u0442 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0443 \\u0432\\u0438\\u0434\\u0430 \\"\'param1\'=\'value1\',...\\" \\u0438 \\u0432\\u043e\\u0437\\u0432\\u0440\\u0430\\u0449\\u0430\\u0435\\u0442 \\u043c\\u0430\\u0441\\u0441\\u0438\\u0432\\nif (!function_exists(\'getconfigparam\')) {\\n\\t\\/\\/ function getconfigparam($config_default_param, $type){\\n\\tfunction getconfigparam($config_default_param){\\n\\t\\tforeach (explode(\\",\\",$config_default_param) as $parametr) {\\n\\t\\t\\t$param_arr=explode(\\"=\\",$parametr);\\n\\t\\t\\t\\t\\/\\/ $param[$type][$param_arr[0]]=$param_arr[1];\\n\\t\\t\\t\\t$param[$param_arr[0]]=$param_arr[1];\\n\\t\\t}\\n\\t\\treturn $param;\\n\\t}\\n}\\n\\n\\/\\/ \\u043f\\u043e\\u043b\\u0443\\u0447\\u0430\\u0435\\u043c \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u044e \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e\\n$config_default = array(\\n\\t\\"src\\"\\t=>\\tgetconfigparam($config_default_src_param),\\n\\t\\"thumb\\" =>\\tgetconfigparam($config_default_thumb_param)\\n);\\n\\n\\/\\/ \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u0435\\u043c\\u043e\\u0433\\u043e \\u0444\\u0430\\u0439\\u043b\\u0430\\n$file = $modx->event->params[\'files\'][\'file\'];\\n$cur_dir = $modx->event->params[\'directory\'];\\n\\n\\n\\/\\/ \\u043f\\u043e\\u043b\\u0443\\u0447\\u0430\\u0435\\u043c media source\\n$ms = $modx->event->params[\'source\'];\\n\\/\\/ \\u0440\\u0430\\u0441\\u0441\\u043a\\u043e\\u043c\\u0435\\u043d\\u0442\\u0438\\u0440\\u043e\\u0432\\u0430\\u0432 \\u0441\\u043b\\u0435\\u0434 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0443 \\u0432\\u044b \\u043c\\u043e\\u0436\\u0435\\u0442\\u0435 \\u0432\\u0437\\u0433\\u043b\\u044f\\u043d\\u0443\\u0442\\u044c \\u043d\\u0430 \\u043d\\u0430\\u0447\\u0438\\u043d\\u043a\\u0443 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0430\\n\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($ms->toArray(),true));\\n\\nif (!empty($exclude_sources)){\\n\\t$exclude_sources = str_replace(\' \', \'\', $exclude_sources);\\n\\t$exclude_sources=explode(\\",\\",$exclude_sources);\\n\\tforeach ($exclude_sources as $sources) {\\n\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, is_numeric($sources));\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Sources list: $sources - \\".$ms->name);\\n\\t\\tif (is_numeric($sources)) {\\n\\t\\t\\tif ($ms->id==(int)$sources) return;\\n\\t\\t}\\n\\t\\telse {\\n\\t\\t\\tif ($ms->name==$sources) return;\\n\\t\\t}\\n\\t}\\t\\n}\\n\\n\\nif($ms == null){\\n\\t\\/\\/ return $modx->error->failure(\\"\\u041e\\u0448\\u0438\\u0431\\u043a\\u0430, \\u043d\\u0435 \\u0443\\u0434\\u0430\\u0435\\u0442\\u0441\\u044f \\u043f\\u043e\\u043b\\u0443\\u0447\\u0438\\u0442\\u044c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u043e\\u0431 \\u0438\\u0441\\u0442\\u043e\\u0447\\u043d\\u0438\\u043a\\u0435 \\u0444\\u0430\\u0439\\u043b\\u043e\\u0432\\");\\n\\t\\/\\/ \\u0442\\u0443\\u0442 \\u043d\\u0443\\u0436\\u043d\\u043e \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u0438\\u0442\\u044c \\u0432\\u0435\\u0440\\u0441\\u0438\\u044e modx, \\u0435\\u0441\\u043b\\u0438 \\u043e\\u043d\\u0430 \\u043c\\u043b\\u0430\\u0434\\u0448\\u0435 2.2.4 \\u0442\\u043e\\n\\t\\/\\/ \\u0438\\u0441\\u043f\\u043e\\u043b\\u044c\\u0437\\u0443\\u0435\\u043c \\n\\t\\/\\/ foreach ($files as $file) {\\n\\t\\t\\/\\/ $ext = @pathinfo($file[\'name\'],PATHINFO_EXTENSION);\\n\\t\\t\\/\\/ rename($cur_dir->getPath().$file[\'name\'], $directory->getPath().UrlTranslit($file[\'name\']));\\n\\t\\/\\/ }\\n\\t\\/\\/ \\u0442\\u043a \\u0432 \\u0441\\u0442\\u0430\\u0440\\u044b\\u0445 \\u0432\\u0435\\u0440\\u0441\\u0438\\u044f\\u0445 \\u0432\\u044b\\u0437\\u043e\\u0432 \\u0441\\u043e\\u0431\\u044b\\u0442\\u0438\\u044f \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0438 \\u0448\\u0435\\u043b \\u043e\\u0434\\u0438\\u043d \\u0440\\u0430\\u0437, \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u0438\\u0442\\u044c!\\n\\t$cur_dir=$directory->getPath();\\n\\n}\\nelse {\\n\\t\\/\\/ \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0438 media source\\n\\t$msProperties = $ms->get(\'properties\');\\n\\t$cur_dir = $msProperties[\'basePath\'][\'value\'].$cur_dir;\\n\\t\\/\\/ \\u043d\\u0430 \\u0432\\u0441\\u044f\\u043a\\u0438\\u0439 \\u0441\\u043b\\u0443\\u0447\\u0430\\u0439 \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430\\u043b\\u0438\\u0447\\u0438\\u0435 \\/\\/ \\u0438 \\u0437\\u0430\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430 \\/\\n\\t$cur_dir = str_replace(\'\\/\\/\', \'\\/\', $cur_dir);\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"\\\\$cur_dir: $cur_dir\\");\\n\\t\\n\\t\\/\\/ \\u0441\\u043c\\u043e\\u0442\\u0440\\u0438\\u043c, \\u0447\\u0442\\u043e \\u043f\\u0440\\u0438 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043a\\u0435 \\u043d\\u0435 \\u0432\\u043e\\u0437\\u043d\\u0438\\u043a\\u043b\\u043e \\u043e\\u0448\\u0438\\u0431\\u043e\\u043a\\n\\tif ($file[\'error\'] != 0) {\\n\\t\\treturn $modx->error->failure($modx->lexicon(\'rionup_error_download\'));\\n\\t}\\n}\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u0438\\n\\/\\/ if ($exclude_dirs and $exclude_dirs=str_replace(\' \', \'\', $exclude_dirs) and (in_array($cur_dir,explode(\\",\\",$exclude_dirs)))){\\nif ($exclude_dirs and ($exclude_dirs=explode(\\",\\",$exclude_dirs))){\\n\\tif ($exclude_dirs_children) {\\n\\t\\n\\t\\tforeach ($exclude_dirs as $path) {\\n\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"EXCLUDE DIRS CONDITIONS: $cur_dir == $path\\");\\n\\t\\t\\t\\/\\/ if ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0432 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0435 &ExChild\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except {$exclude_dirs_suffix} in: {$path}, return;\\");\\n\\t\\t\\t\\/\\/ }\\n\\t\\t\\t\\/\\/ else {\\n\\t\\t\\t\\t\\n\\t\\t\\t\\t\\/\\/ if (strpos($cur_dir, str_replace($exclude_dirs_suffix, \'\', $path)) !== false) \\/\\/return;\\n\\t\\t\\t\\tif (strpos($cur_dir, $path) !== false) \\/\\/return;\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\/\\/ return $modx->error->failure(\\"children\\");\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except children, return;\\");\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\/\\/ }\\n\\t\\t}\\n\\t}\\n\\telse {\\n\\t\\tforeach ($exclude_dirs as $path) {\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"EXCLUDE DIRS CONDITIONS: curdir ($cur_dir), exclude dir ($path)\\");\\n\\t\\t\\tif ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442 \\u0432 \\u0441\\u0442\\u0440\\u043e\\u043a\\u0435 &ExChild\\n\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except {$exclude_dirs_suffix} in: {$path}, return;\\");\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\tif ($cur_dir==str_replace($exclude_dirs_suffix, \'\', $path)) {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except dir, return;\\");\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\/\\/ return $modx->error->failure(\\"\\u0417\\u0430\\u043f\\u0438\\u0441\\u0430\\u0442\\u044c \\u0432 \\u0434\\u0430\\u043d\\u043d\\u0443\\u044e \\u0434\\u0438\\u0440\\u0435\\u043a\\u0442\\u043e\\u0440\\u0438\\u044e \\u043d\\u0435\\u043b\\u044c\\u0437\\u044f \\u043e\\u043d\\u0430 \\u043d\\u0430\\u0445\\u043e\\u0434\\u0438\\u0442\\u0441\\u044f \\u0432 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\");\\n\\t\\t\\/\\/ return $modx->error->failure(\\"parent\\");\\n\\t\\t}\\n\\t}\\n}\\n\\n\\/\\/ $name = $file[\'name\'];\\n$name = urldecode($file[\'name\']);\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0430 \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u044f \\u0432 \\u0438\\u043c\\u0435\\u043d\\u0438 \\u0444\\u0430\\u0439\\u043b\\u0430\\nif (!empty($exclude_part_of_name) and (strpos($name, $exclude_part_of_name) !== false)){\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except part of name, return;\\");\\n\\treturn;\\n}\\n\\n$extensions = explode(\',\', $modx->getOption(\'upload_images\'));\\nif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Allowed extensions: \\".implode(\\",\\", $extensions));\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u043c, \\u0447\\u0442\\u043e \\u043d\\u0430\\u0448\\u0430 \\u043a\\u0430\\u0442\\u0435\\u0433\\u043e\\u0440\\u0438\\u044f \\u0437\\u0430\\u0434\\u0430\\u043d\\u0430 \\u0432 \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0430\\u0445 \\u043f\\u043b\\u0430\\u0433\\u0438\\u043d\\u0430\\nif (array_key_exists($cur_dir, $config)) {\\n\\t$config = $config[$cur_dir];\\n}\\nelse {\\n\\t$config=$config_default;\\n}\\n\\n\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($config));\\n\\n\\/\\/ \\u043f\\u0443\\u0442\\u044c \\u043a \\u0444\\u0430\\u0439\\u043b\\u0443, \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430, \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435\\n$filename = MODX_BASE_PATH.$cur_dir.$name;\\nif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"SourceFilename: {$filename}\\");\\n$def_fn = pathinfo($name, PATHINFO_FILENAME);\\n$ext = pathinfo($name, PATHINFO_EXTENSION);\\n\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c, \\u0447\\u0442\\u043e \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0437\\u0430\\u0434\\u0430\\u043d\\u043e \\u0432 \\u043d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0430\\u0445 MODX, \\u043a\\u0430\\u043a \\u0438\\u0437\\u043e\\u0431\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u0435\\nif (in_array($ext, $extensions)) {\\n\\n\\t\\/\\/ \\u043f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u0438\\u0441\\u043a\\u043b\\u044e\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 \\u0444\\u0430\\u0439\\u043b\\u0430 exclude_extensions\\n\\tif ($exclude_extensions and $exclude_extensions=str_replace(\' \', \'\', $exclude_extensions) and ($exclude_extensions=explode(\\",\\",$exclude_extensions)) and (in_array($ext, $exclude_extensions))){\\n\\t\\t\\/\\/ if (in_array($ext, $exclude_extensions)) {\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"except extension of file ({$ext}), return;\\");\\n\\t\\treturn;\\t\\n\\t}\\n\\n\\t\\/\\/ \\u0431\\u0435\\u0436\\u0438\\u043c \\u043f\\u043e \\u0432\\u0441\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f\\u043c \\u043c\\u0430\\u0441\\u0441\\u0438\\u0432\\u0430 \\u0441 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u043e\\u043c\\n\\tforeach($config as $imgKey =>$imgConfig){\\n\\t\\t$options = \'\';\\n\\t\\tif($imgKey == \'src\'){\\n\\t\\t\\t\\/\\/ \\u0434\\u043b\\u044f \\u043a\\u043b\\u044e\\u0447\\u0430 src \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0430\\u0435\\u0442 \\u0441 \\u0438\\u0441\\u0445\\u043e\\u0434\\u043d\\u044b\\u043c\\n\\t\\t\\t$imgName = $filename;\\n\\t\\t}\\n\\t\\telseif ($imgKey == \'thumb\' and $create_thumbs){\\n\\t\\t\\t\\/\\/ \\u0444\\u043e\\u0440\\u043c\\u0438\\u0440\\u0443\\u0435\\u043c \\u0438\\u043c\\u044f \\u0444\\u0430\\u0439\\u043b\\u0430\\n\\t\\t\\t\\n\\t\\t\\t\\/\\/$imgName = MODX_BASE_PATH.$cur_dir.$def_fn.\'.\'.$ext.\'.\'.$imgKey.\'.\'.$ext;\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"\\\\$cur_dir: $cur_dir\\");\\n\\t\\t\\tif (!empty($thumbnail_dir) or !empty($default_thumb_path)) {\\n\\t\\t\\t\\t$thumbnail_dir = MODX_BASE_PATH.$cur_dir.$thumbnail_dir.\\"\\/\\";\\n\\t\\t\\t\\tif (!empty($default_thumb_path)) {\\n\\t\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0443\\u043a\\u0430\\u0437\\u0430\\u043d\\u0430 \\u043f\\u043e\\u0430\\u043f\\u043a\\u0430 \\u043f\\u043e-\\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0434\\u043b\\u044f \\u043f\\u0440\\u0435\\u0432\\u044c\\u044e\\u0448\\u0435\\u043a\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Default thumbnail path exist\\");\\n\\t\\t\\t\\t\\tif (substr($default_thumb_path, -1, 1)!=\\"\\/\\") $default_thumb_path.=\\"\\/\\";\\n\\t\\t\\t\\t\\t$thumbnail_dir = MODX_BASE_PATH.$default_thumb_path;\\t\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail full path: {$thumbnail_dir}\\");\\n\\t\\t\\t\\tif(!is_dir($thumbnail_dir)) {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir not exist\\");\\n\\t\\t\\t\\t\\tif (!mkdir($thumbnail_dir,0755)){\\n\\t\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail error:\\".$modx->lexicon(\'rionup_error_createdir\'));\\n\\t\\t\\t\\t\\t\\treturn $modx->error->failure($modx->lexicon(\'rionup_error_createdir\'));\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse{\\n\\t\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir created successfull\\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Thumbnail dir already exist\\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\/\\/ $filename = $thumbnail_dir.$name;\\n\\t\\t\\t\\t\\/\\/ $imgName = $thumbnail_dir.$def_fn.\'_\'.$imgKey.\'.\'.$ext;\\n\\t\\t\\t\\t$imgName = \\"{$thumbnail_dir}{$def_fn}{$thumb_key}_w{$imgConfig[\'w\']}_h{$imgConfig[\'h\']}.{$ext}\\";\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Part: {$imgKey}, imgName: {$imgName}\\");\\n\\n\\t\\t\\/\\/ \\u0441\\u043e\\u0437\\u0434\\u0430\\u0435\\u043c \\u043e\\u0431\\u044a\\u0435\\u043a\\u0442 phpThumb..\\n\\t\\t$phpThumb = new phpThumb();\\n\\t\\t\\/\\/ ..\\u0438 \\u0437\\u0430\\u0434\\u0430\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n\\t\\t\\/\\/ $thumbnail->setOptions($options); \\/\\/ \\u0445\\u043e\\u0442\\u0435\\u043b \\u0447\\u0435\\u0440\\u0435 \\u044d\\u0442\\u043e \\u0441\\u0434\\u0435\\u043b\\u0430\\u0442\\u044c - \\u043d\\u0435 \\u043f\\u043e\\u043b\\u0443\\u0447\\u0438\\u043b\\u043e\\u0441\\u044c\\n\\t\\t$phpThumb->setSourceFilename($filename);\\n\\t\\t\\n\\t\\tif (empty($imgConfig[\'f\'])){\\n\\t\\t\\t$imgConfig[\'f\']=$ext; \\/\\/ \\u0431\\u0435\\u0437 \\u044d\\u0442\\u043e\\u0433\\u043e \\u043c\\u044b \\u043d\\u0435 \\u0443\\u0432\\u0438\\u0434\\u0438\\u043c \\u043f\\u0440\\u043e\\u0437\\u0440\\u0430\\u0447\\u043d\\u043e\\u0441\\u0442\\u0438 \\u0432 png \\u0438 gif\\n\\t\\t}\\n\\t\\tif (!empty($imgConfig)){\\n\\t\\t\\tif (($ext==\'png\' or $ext==\'gif\') and !empty($imgConfig[\'fltr\'])){\\n\\t\\t\\t\\t\\/\\/ \\u0435\\u0441\\u043b\\u0438 \\u0440\\u0430\\u0441\\u0448\\u0438\\u0440\\u0435\\u043d\\u0438\\u0435 png \\u0438\\u043b\\u0438 gif \\u0438 \\u043f\\u0440\\u0438\\u043c\\u0435\\u043d\\u044f\\u0435\\u0442\\u0441\\u044f \\u0444\\u0438\\u043b\\u044c\\u0442\\u0440\\n\\t\\t\\t\\t\\/\\/ \\u043f\\u043e\\u0434\\u0440\\u0430\\u0437\\u0443\\u043c\\u0435\\u0432\\u0430\\u0435\\u0442\\u0441\\u044f \\u0434\\u043e\\u0431\\u0430\\u0432\\u043b\\u0435\\u043d\\u0438\\u0435 watermark\\n\\t\\t\\t\\t\\/\\/ \\u0438 \\u0447\\u0442\\u043e\\u0431\\u044b \\u043d\\u0430\\u0448 watermark \\u043d\\u0435 \\u0440\\u0430\\u0441\\u043f\\u043e\\u043b\\u043e\\u0433\\u0430\\u043b\\u0441\\u044f \\u043d\\u0430 \\u0446\\u0432\\u0435\\u0442\\u043d\\u043e\\u043c \\u0444\\u043e\\u043d\\u0435\\n\\t\\t\\t\\t\\/\\/ \\u043c\\u044b \\u0435\\u0433\\u043e \\u0443\\u0434\\u0430\\u043b\\u044f\\u0435\\u043c\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"Destroy background for watermark\\");\\n\\t\\t\\t\\t\\/\\/ unset($imgConfig[\'bg\']);\\n\\t\\t\\t}\\n\\t\\t\\t\\n\\t\\t\\tforeach ($imgConfig as $k => $v) {\\n\\t\\t\\t\\t\\/\\/ if ($log) $modx->log(modX::LOG_LEVEL_INFO,\\"$k - $v\\");\\n\\t\\t\\t\\t$phpThumb->setParameter($k, $v);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t   \\n\\t\\t\\/\\/ \\u0433\\u0435\\u043d\\u0435\\u0440\\u0438\\u0440\\u0443\\u0435\\u043c \\u0444\\u0430\\u0439\\u043b\\n\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"GenerateThumbnail...\\");\\n\\t\\tif ($phpThumb->GenerateThumbnail()) {\\n\\t\\t\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"RenderToFile: $imgName\\");\\n\\t\\t\\tif ($phpThumb->RenderToFile($imgName)) {\\n\\t\\t\\t\\t\\/\\/ \\u0443\\u0441\\u0442\\u0430\\u043d\\u0430\\u0432\\u043b\\u0438\\u0432\\u0430\\u0435\\u043c \\u043f\\u0440\\u0430\\u0432\\u0430 \\u043d\\u0430 \\u0444\\u0430\\u0439\\u043b, \\u044d\\u0442\\u043e \\u043e\\u043f\\u0446\\u0438\\u043e\\u043d\\u0430\\u043b\\u044c\\u043d\\u043e, \\u0437\\u0430\\u0432\\u0438\\u0441\\u0438\\u0442 \\u043e\\u0442 \\u0441\\u0435\\u0440\\u0432\\u0435\\u0440\\u0430\\n\\t\\t\\t\\tchmod($imgName, 0666);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\\nelse {\\n\\tif ($log) $modx->log(modX::LOG_LEVEL_INFO, \\"extension of file ({$ext}) is forbidden for download in system parameters \'upload_images\'. Allow only: \\".implode(\\",\\", $extensions));\\n}\\nreturn;"}',
        'guid' => '215a21261495057f15d39434d3603ed8',
        'native_key' => 1,
        'signature' => '6579ebb630f9c5fbdb348096cb26242c',
      ),
    ),
  ),
  'related_object_attributes' => 
  array (
    'Snippets' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Chunks' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Plugins' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
      'related_objects' => true,
      'related_object_attributes' => 
      array (
        'PluginEvents' => 
        array (
          'preserve_keys' => true,
          'update_object' => false,
          'unique_key' => 
          array (
            0 => 'pluginid',
            1 => 'event',
          ),
        ),
      ),
    ),
  ),
  'namespace' => 'resizeimageonupload',
  'resolve' => NULL,
  'validate' => NULL,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '376f4020b7276bd4826ababe97632c35',
  'package' => 'modx',
  'class' => 'modCategory',
  'signature' => 'c2a8137ad0c72ec8b002d2f3d5801953',
  'native_key' => 1,
  'object' => '{"id":1,"parent":0,"category":"ResizeImageOnUpload"}',
);